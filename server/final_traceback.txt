INFO 2025-12-13 12:57:02,804 model_selector 16552 7844 Selected model: gemini-2.0-flash (confidence: 0.780, provider: gemini)
INFO 2025-12-13 12:57:02,804 model_selector 16552 7844 Selected model: gemini-2.0-flash (confidence: 0.780, provider: gemini)
WARNING 2025-12-13 12:57:02,805 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
WARNING 2025-12-13 12:57:02,805 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
INFO 2025-12-13 12:57:04,728 _client 16552 8128 HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 429 Too Many Requests"
INFO 2025-12-13 12:57:04,730 gemini 16552 8128 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 56s
INFO 2025-12-13 12:57:04,730 gemini 16552 8128 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 56s
WARNING 2025-12-13 12:57:04,756 learning_engine 16552 7844 Recorded failure for gemini-2.0-flash: type=UNKNOWN, blocked=False, health=80
WARNING 2025-12-13 12:57:04,756 learning_engine 16552 7844 Recorded failure for gemini-2.0-flash: type=UNKNOWN, blocked=False, health=80
ERROR 2025-12-13 12:57:04,766 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-2.0-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

ERROR 2025-12-13 12:57:04,766 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-2.0-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

WARNING 2025-12-13 12:57:04,766 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-2.0-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:04,766 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-2.0-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:04,767 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
WARNING 2025-12-13 12:57:04,767 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
INFO 2025-12-13 12:57:06,468 _client 16552 17220 HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 429 Too Many Requests"
INFO 2025-12-13 12:57:06,470 gemini 16552 17220 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 54s
INFO 2025-12-13 12:57:06,470 gemini 16552 17220 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 54s
WARNING 2025-12-13 12:57:06,502 learning_engine 16552 7844 Recorded failure for gemini-1.5-flash: type=UNKNOWN, blocked=False, health=80
WARNING 2025-12-13 12:57:06,502 learning_engine 16552 7844 Recorded failure for gemini-1.5-flash: type=UNKNOWN, blocked=False, health=80
ERROR 2025-12-13 12:57:06,507 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-1.5-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

ERROR 2025-12-13 12:57:06,507 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-1.5-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

WARNING 2025-12-13 12:57:06,507 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-1.5-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:06,507 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-1.5-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:06,508 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
WARNING 2025-12-13 12:57:06,508 encryption 16552 7844 Using derived encryption key from SECRET_KEY. Set AI_GATEWAY_ENCRYPTION_KEY in production!
INFO 2025-12-13 12:57:08,339 _client 16552 2548 HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent "HTTP/1.1 429 Too Many Requests"
INFO 2025-12-13 12:57:08,340 gemini 16552 2548 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 52s
INFO 2025-12-13 12:57:08,340 gemini 16552 2548 Gemini model gemini-2.0-flash-exp quota exceeded (429). Retry-After: 52s
WARNING 2025-12-13 12:57:08,366 learning_engine 16552 7844 Recorded failure for gemini-1.5-flash: type=UNKNOWN, blocked=False, health=80
WARNING 2025-12-13 12:57:08,366 learning_engine 16552 7844 Recorded failure for gemini-1.5-flash: type=UNKNOWN, blocked=False, health=80
ERROR 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-1.5-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

ERROR 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI v2] Detailed Traceback for gemini-1.5-flash:
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 186, in _try_gateway
    learning_engine.record_failure(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        instance=instance,
        ^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retry_after_seconds=getattr(response, 'retry_after_seconds', None),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 160, in record_failure
    self._handle_quota_exceeded(instance, retry_after_seconds)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\vocab_web\server\api\ai_gateway\services\learning_engine.py", line 282, in _handle_quota_exceeded
    output_field=models.IntegerField()
                 ^^^^^^
NameError: name 'models' is not defined

WARNING 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-1.5-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI v2] Exception: gemini-1.5-flash: name 'models' is not defined
WARNING 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI] Gateway attempt failed: AI Gateway initialization failed: All AI models failed. Last error: name 'models' is not defined
WARNING 2025-12-13 12:57:08,373 unified_ai 16552 7844 [UnifiedAI] Gateway attempt failed: AI Gateway initialization failed: All AI models failed. Last error: name 'models' is not defined
Traceback (most recent call last):
  File "E:\vocab_web\server\api\unified_ai.py", line 237, in _try_gateway
    raise Exception(f"All AI models failed. Last error: {last_error}")
Exception: All AI models failed. Last error: name 'models' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\vocab_web\server\debug_traceback.py", line 16, in <module>
    print(generate_ai_content(u, 'test'))
          ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\vocab_web\server\api\unified_ai.py", line 74, in generate_ai_content
    raise e
  File "E:\vocab_web\server\api\unified_ai.py", line 68, in generate_ai_content
    gateway_result = _try_gateway(user, prompt, max_tokens, temperature, required_capabilities, quality_tier)
  File "E:\vocab_web\server\api\unified_ai.py", line 242, in _try_gateway
    raise Exception(f"AI Gateway initialization failed: {e}")
Exception: AI Gateway initialization failed: All AI models failed. Last error: name 'models' is not defined
WARNING: Using development SECRET_KEY. Set DJANGO_SECRET_KEY environment variable for production!
Testing with user: assad.allah630
Top level exception caught:
